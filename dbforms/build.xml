<project name="dbforms" default="createAllExamples" basedir=".">

    <!-- 

$Header$
$Revision$
$Date$

ANT BUILD.XML FOR DbForms
=========================

Ant is a very handy tool that uses a build file written in XML
(this file) as building instructions. For more information refer to
"http://jakarta.apache.org/ant/".

To build DbForms using ant, perform the following steps:
*) install jakarte-ant properly (tested with ant Version 1.3)
*) set environment variable JAVA_HOME pointing to your Java Installation
*) cd to the directory containing this build.xml file
*) type in "ant" - this should do it!!

Results:
*) a .jar file containing the DbForms library
*) a .war file for each sample app in directory /dist

Deploy the .war files to your Servlet 2.2+ compatible servlet container!
If you are not using mysql -> you have to edit the dbforms-config.xml file to set up the database connection
properly.

Happy coding!
~~ DbForms team ~~

-->

    <property name="dbforms.version" value="_v1_05"/>

    <property name="cvs.workingdir" value="."/>

    <property name="javasrc.dir" value="${cvs.workingdir}/src"/>
    <property name="xslsrc.dir" value="${cvs.workingdir}/xsl-stylesheets"/>
    <property name="etc.dir" value="${cvs.workingdir}/etc"/>
    <property name="examples.dir" value="${cvs.workingdir}/examples"/>
    <property name="build.dir" value="${cvs.workingdir}/build"/>
    <property name="dist.dir" value="${cvs.workingdir}/dist"/>
    <property name="dependend.dir" value="${cvs.workingdir}/dependend"/>


    <!-- Indentify Classpath -->
    <path id="classpath">
        <fileset dir="${dependend.dir}">
            <include name="*.jar"/>
        </fileset>
    </path>


    <target name="clearWorkspace">
        <delete dir="${build.dir}"/>
        <mkdir dir="${build.dir}"/>
    </target>

    <target name="cleanWorkspace">
        <delete dir="${build.dir}"/>
    </target>

    <target name="prepare" depends="clearWorkspace">
        <delete dir="${dist.dir}"/>
        <mkdir dir="${dist.dir}"/>
    </target>


    <!-- compile dbforms core sources -->
    <target name="compile" depends="prepare">


        <!-- Required when building in eclipse (WSAD) -->
        <available classname="org.eclipse.core.launcher.Main" property="build.compiler" value="org.eclipse.pde.internal.core.JDTCompilerAdapter" classpath="${java.class.path}"/>

        <javac srcdir="${javasrc.dir}/org/dbforms" destdir="${build.dir}" debug="on" optimize="off" deprecation="off">
            <classpath refid="classpath"/>
        </javac>
    </target>


    <!-- generate dbforms_x.jar library -->
    <target name="jar_classes" depends="prepare,compile">
        <jar jarfile="${dist.dir}/dbforms${dbforms.version}.jar" manifest="${etc.dir}/dbforms_manifest" basedir="${build.dir}"/>
    </target>


    <!-- generate taglib descriptors from taglib-docu using XSL transformation -->
    <target name="generate_taglib" depends="jar_classes">
        <echo message="begin xsl translation"/>
        <java classname="org.apache.xalan.xslt.Process" fork="true" jvm="${java.home}/bin/java.exe" args="-IN ${etc.dir}/taglib_docu.xml -XSL ${etc.dir}/tld.xsl -OUT ${dist.dir}/dbforms.tld"/>
        <echo message="end of xsl translation "/>
    </target>


    <!-- make an example app -->

    <target name="createExample">

        <echo message="BUILDING EXAMPLE: ${example.name}"/>

        <!-- create some workspace -->
        <antcall target="clearWorkspace"/>

        <!-- copy sources to our workspace -->
        <copy todir="${build.dir}/${example.name}">
            <fileset dir="${examples.dir}/${example.name}"/>
        </copy>

        <!-- copy dbforms - jar to WEB-INF/lib -->
        <copy file="${dist.dir}/dbforms${dbforms.version}.jar" todir="${build.dir}/${example.name}/WEB-INF/lib"/>

        <!-- copy taglib-descriptor to WEB-INF -->
        <copy file="${dist.dir}/dbforms.tld" todir="${build.dir}/${example.name}/WEB-INF"/>

        <!-- copy libraries dbforms depends on to WEB-INF/lib -->
        <copy todir="${build.dir}/${example.name}/WEB-INF/lib">
            <fileset dir="${dependend.dir}"/>
        </copy>

        <!-- compile example-specific Java code -->
        <echo message="compiling example specific code"/>
        <javac srcdir="${build.dir}/${example.name}/src" destdir="${build.dir}/${example.name}/WEB-INF/classes" debug="on" optimize="off" deprecation="off" classpath="${dist.dir}/dbforms${dbforms.version}.jar"/>
        <echo message="finished compiling example specific code"/>

        <!-- creating WAR file for this example -->
        <jar jarfile="${dist.dir}/${example.name}.war" basedir="${build.dir}/${example.name}" includes="*/**"/>
    </target>


    <target name="createAllExamples" depends="generate_taglib">
        <antcall target="createExample">
            <param name="example.name" value="bugtracker"/>
        </antcall>

        <antcall target="createExample">
            <param name="example.name" value="testsuite"/>
        </antcall>

        <!-- clean up temporary directories -->
        <antcall target="cleanWorkspace"/>

    </target>


</project>