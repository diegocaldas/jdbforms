<project default = ""
	 xmlns:deploy="deploy"
	 xmlns:doc="doc" 
         xmlns:m = "maven"
         xmlns:j = "jelly:core"
         xmlns:u = "jelly:util"
	 >

<echo message="Hack to use xalan transformer!"/>
${systemScope.setProperty('javax.xml.transform.TransformerFactory','org.apache.xalan.processor.TransformerFactoryImpl')}


  <!--
     -  Build the additional DbForms documentation:
     -    tag library
     -    docbook guide 
     -->
  <goal name="dbforms:doc" description="generate dbforms documentation: taglib docu and manual">
    <j:jelly xmlns:j="jelly:core" xmlns="jelly:ant">
      <echo message="building the DbForms documentation user guide and jsp tag library"/>
      <ant antfile="docs.xml" target="maven-build-doc"/>
    </j:jelly>
  </goal>

  <goal name="dbforms:dist" description="generates the distribution via build.xml">
     <echo message="building the distribution using ant "/>
     <echo message="generate version ${pom.currentVersion}"/>
     <ant antfile="build.xml" target="maven-build-release">
     	<property name="dbforms.version" value="${pom.currentVersion}" />
     </ant>
  </goal>

  <goal name="dbforms:dependend">
    <deploy:copy-deps todir="dist/dependend" excludes="servletapi" />
  </goal>

  <goal name="dbforms:deploy" description="do the whole deployment: generates site, generates doc, generates distribution">
     <echo message="starting deploying site"/>
     <echo message="generate changes"/>
     <echo message="1. generate whole site"/>
     <attainGoal name="site:generate"/>
     <echo message="2. generate dbforms documentation via docs.xml"/>
     <attainGoal name="dbforms:doc"/>
     <echo message="3. copy depended"/>
     <attainGoal name="dbforms:dependend"/>
     <echo message="4. build the distribution via build.xml"/>
     <attainGoal name="dbforms:dist"/>
  </goal>


  <postGoal name="maven-changes-plugin:report">
      <echo message="build changes.xml"/>
     <doc:text-xdoc  title="Changes"
	    section="CHANGES"
            output="target/generated-xdocs/changes-report.xml"
            inputFile="ChangeLog"/>
  </postGoal>
  <!--
     -  Move the $DBFORMS_HOME/target/docs/* stuff into the 
     -  $DBFORMS_HOME/doc directory
     -->
  <postGoal name="site:generate">
    <j:jelly xmlns:j="jelly:core" xmlns="jelly:ant">
      <echo message="moving the Maven docs stuff into the main DbForms doc directory"/>
      <ant antfile="docs.xml" target="maven-move-doc"/>
    </j:jelly>
  </postGoal>



</project>
