<?xml version="1.0" encoding="UTF-8" ?>

<!-- Created by Administrator on December 10, 2002, 2:54 PM -->

<chapter><title>Installation</title>
<para>You can utilize a binary distribution of DbForms in your own web applications
by following these steps.</para>
<para>Users of MS SQL Server should refer instead to <link linkend='mssql'>JumpStart MS Server Database</link></para>
<para>If you have questions, please drop a line to our <ulink url="http://lists.sourceforge.net/lists/listinfo/jdbforms-interest"><citetitle>mailing list</citetitle></ulink></para>
<sect1><title id="prereqs">Prerequisites</title>
<orderedlist numeration="upperroman">
<note>
<para>the following resources (except for Sun's JDK/SDK) are hosted at our site and <ulink url="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/jdbforms/dbforms/dependend/"><citetitle>you can donwload the JARs</citetitle></ulink> from there or you can download the latest releases from their respective sites: 
</para>
</note>
<listitem>
<para>Download and install a Java2 (version 1.2 or later) Java Development Kit implementation for your operating system platform.  Define an environment variable JAVA_HOME that points at the base directory of your JDK installation, and add the directory "$JAVA_HOME/bin" to your PATH variable.</para>
</listitem>
<listitem>
<para>Download and install an XML parser that is compatible with the Java API for XML Parsing (JAXP) specification.  A useful XML parser is the <ulink url="http://java.sun.com/xml"><citetitle>JAXP Reference Implementation</citetitle></ulink>, version 1.1 or later. Version 1.1 of DbForms has been upgraded to use the Apache commons framework.  
This framework required Java XML Parser (JAXP) v1.1.  Older Web containers 
(such as Tomcat v3.2.x) are still using JAXP v1.0 technology and are therefore 
incompatible.</para><para>Another JAXP-compatible parser is <ulink url="http://xml.apache.org"><citetitle>Xerces</citetitle></ulink>, version 1.4.4 or later.</para><para>Be sure to add the "jaxp.jar" and "parser.jar" (or whatever JAR file comes with your parser) files to your CLASSPATH environment variable.</para>
</listitem>
<listitem>
<para>Download <ulink url="http://jakarta.apache.org/log4j/docs/download.html"><citetitle> the log4j </citetitle></ulink> toolkit
  (log4j.jar)</para>
</listitem>
<listitem>
<para>Download <ulink url="http://www.oreilly.com"><citetitle>Jason Hunters multipart servlet</citetitle></ulink> classes from O'Reilly (cos.jar)</para>
</listitem>
<listitem>
<para>Download <ulink url="http://jakarta.apache.org/struts"><citetitle>the struts framework</citetitle></ulink> (struts.jar)</para>
</listitem>
<listitem>
<para>Download <ulink url="http://jakarta.apache.org"><citetitle>these jars</citetitle></ulink> which are all in the Commons project</para>
<itemizedlist mark="opencircle">
<listitem>
<para>
commons-beanutils.jar 
</para>
</listitem>
<listitem>
<para>
commons-collections.jar
</para>
</listitem>
<listitem>
<para>
commons-digester.jar 
</para>
</listitem>
 <listitem>
<para>
commons-logging.jar
</para>
</listitem>
<listitem>
<para>
commons-validator.jar 
</para>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<para>Download <ulink url="http://jakarta.apache.org"><citetitle>jakarta-oro-2.0.6.jar </citetitle></ulink>which is in the ORO project </para>
</listitem>
  <listitem>
<para>Download <ulink url="http://jakarta.apache.org"><citetitle>log4j.jar </citetitle></ulink>which is in the Log4j project </para>
</listitem>
<listitem>
<para>Download <ulink url="http://www.oreilly.com"><citetitle>cos.jar </citetitle></ulink> </para>
</listitem>
<listitem>
<para>Download Download and install a servlet container that supports the Servlet API Specification, version 2.2 or later, and the JavaServer Pages (JSP) Specification, version 1.1 or later.
</para>
<para>A useful servlet container is <ulink url="http://jakarta.apache.org"><citetitle>Tomcat</citetitle></ulink>, version 3.2 or later for dbforms 1.07 and ??? for 1.1 and on</para>
</listitem>
<listitem>
<para>
 ... and of course, download and unpack a DbForms binary distribution
</para>
</listitem>
</orderedlist>
 
  

 
</sect1>
 <sect1><title>running the examples</title> 
 <orderedlist numeration="lowerroman">
<listitem>
 
<para>create the database by executing the SQL commands listed in example/*/WEB-INF/*.sql</para>
</listitem>
<listitem>
<para> OPTIONAL: configure a database connection pool for that new created database using your favorite technique (either the connection pool built into your application server or codestudio's poolman or another database connection tool) connection pools are important to speed-up your application</para>
</listitem>
<listitem>
<para>Install the DbForms example applications by deploying the directory of the application into your servlet container, using the standard techniques supported by that container.</para><para> (For Tomcat, simply copy this
  directory to the $TOMCAT_HOME/webapps directory and restart Tomcat).</para>
 
</listitem>
<listitem>
<para>Do not forget to point the db-connection entry in <computeroutput>/WEB-INF/dbforms-config.xml</computeroutput> to the datasource or connection pool you established!</para>
</listitem>
<listitem>
<para>Take a look into /example/README.txt and the other README_XXX files in the examples-directory!
</para>
</listitem>
<listitem><para>
Finally, point your web browser to http://127.0.0.1/example or if you changed the directory name then point to http://127.0.0.1/{$NAME} !
</para></listitem>

</orderedlist>
</sect1>
<sect1><title>Building your own DbForms- capable applications</title>
 <orderedlist numeration="lowerroman">
<listitem>
<para>Copy the files "<computeroutput>dist/dbforms.tld</computeroutput>" from the DbForms distribution into the "<computeroutput>WEB-INF</computeroutput>" directory of your web application.<footnote>
<para>
NOTE: the file "dbforms.tld" was named "taglib.tld" in some prior versions. this name was too generic and the risk of naming conflicts was too big, therefore we changed the name. Be sure to use "dbforms.tld"!
</para>
</footnote>
</para>
</listitem>
<listitem>
<para>Copy the file "<computeroutput>dist/dbforms_v?.jar</computeroutput>" from the DbForms distribution into the
  "<computeroutput>WEB-INF/lib</computeroutput>" directory of your web application</para>
</listitem>
<listitem>
<para>Copy the jars (listed in <link linkend='prereqs'>prerequisites</link> section) into the
  "<computeroutput>WEB-INF/lib</computeroutput>" directory of your web application.</para><para>Note: only <computeroutput>stuts.jar</computeroutput> is needed and not the whole Struts distribution</para>
</listitem>
<listitem>
<para>Modify your "<computeroutput>WEB-INF/web.xml</computeroutput>" file to include 3 &lt;servlet&gt; element to define the controller, the config and the file-servlet (<link linkend='depldesc'>see below</link>) </para>
</listitem>
<listitem>
<para>Modify the "<computeroutput>WEB-INF/web.xml</computeroutput>" file for your web application to include a tag library declaration for the Dbforms tag library and a TEMPLATE-Basedir(<link linkend='taglibdesc'>see below</link>)</para>
<para>See <link linkend='tempbasedir'>templates base directory</link> for more info.</para>
</listitem>
<listitem>
<para>Create a file "<computeroutput>WEB-INF/dbforms-config.xml</computeroutput>" that defines the tables, fields
  and the database connection to use. <emphasis role="bold">This can be GENERATED AUTOMATICALLY (along with jsp pages) by using <link linkend='devgui'>DEVGUI</link></emphasis></para>
</listitem>
<listitem>
<para>Optionally, create a file "<computeroutput>WEB-INF/dbforms-errors.xml</computeroutput>" that defines error messages</para>
</listitem>
<listitem>
<para>In each JSP page that will use the DbForms custom tags, add a line at
  the top of the page like this (for each Struts tag library needed):</para>
  <screen>
    &lt;%@ taglib uri="/WEB-INF/dbforms.tld" prefix="db" %&gt;
</screen>
<para>(If you wish, you can use a prefix other that "db" and you can place the 
  taglib descriptor to an other place as well!)</para>
</listitem>
<listitem>
 <para>Finally, make sure that the database configuration you're pointing to in <computeroutput>dbforms-config.xml </computeroutput>is really working. Whether this is an easy task or not, depends heavily on the server you are using.
</para>
			<para>Common reasons for database-related problems are:
</para>
    <itemizedlist mark="opencircle">
    <listitem>
    <para>JDBC drivers not in classpath
    </para>
    </listitem>
    <listitem>
    <para>Connection pools not in classpath
    </para>
    </listitem>
    <listitem>
    <para>Driver/Connection-pool resources (property-files) not in classpath
    </para>
    </listitem>
    <listitem>
    <para>Misspelled connection URLs or JNDI-keys
    </para>
    </listitem>
    </itemizedlist>
		
			
			
			
 
</listitem>
</orderedlist>

 
  
 
<sect2 id="depldesc">
			<title>Edit deployment descriptor web.xml
</title>
			<para>Add the following &lt;<computeroutput>servlet</computeroutput>&gt;, &lt;<computeroutput>context-param</computeroutput>&gt; and &lt;<computeroutput>taglib</computeroutput>&gt; - elements to the &lt;<computeroutput>web</computeroutput>-<computeroutput>app</computeroutput>&gt; element in your applications  <computeroutput>/WEB-INF/web.xml</computeroutput> file
</para>
			<example>
				<title>Changes in web.xml to enable DbForms(1)
</title>
				<programlisting>
&lt;web-app&gt;&lt;!--=========== DbForms Configuration Servlet ===========--&gt; 
    &lt;servlet&gt; 
        &lt;servlet-name&gt;org.dbforms.ConfigServlet&lt;/servlet-name&gt; 
        &lt;servlet-class&gt;org.dbforms.ConfigServlet&lt;/servlet-class&gt; 
	
        &lt;init-param&gt; 
            &lt;param-name&gt;log4j.configuration&lt;/param-name&gt; 
            &lt;param-value&gt;log4j.properties&lt;/param-value&gt; 
	&lt;/init-param&gt;
        &lt;init-param&gt; 
            &lt;param-name&gt;digesterDebugLevel&lt;/param-name&gt; 
            &lt;param-value&gt;0&lt;/param-value&gt; 
	&lt;/init-param&gt; 
	&lt;init-param&gt; 
            &lt;param-name&gt;resourceBundle&lt;/param-name&gt; 
            &lt;param-value&gt;ApplicationResources&lt;/param-value&gt; 
        &lt;/init-param&gt; 
	&lt;init-param&gt; 
            &lt;param-name&gt;validation&lt;/param-name&gt; 
            &lt;param-value&gt;/WEB-INF/validation.xml&lt;/param-value&gt; 
	&lt;/init-param&gt; 
        &lt;init-param&gt; 
		&lt;param-name&gt;validator-rules&lt;/param-name&gt; 
		&lt;param-value&gt;/WEB-INF/validator-rules.xml&lt;/param-value&gt; 
	&lt;/init-param&gt; 
	
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt; 
                
    &lt;/servlet&gt;&lt;!--=========== DbForms Controller Servlet ==============--&gt; 
		
    &lt;servlet&gt; 
	&lt;servlet-name&gt;control&lt;/servlet-name&gt; 
	&lt;servlet-class&gt;org.dbforms.Controller&lt;/servlet-class&gt; 
            &lt;init-param&gt; 
		&lt;param-name&gt;maxUploadSize&lt;/param-name&gt; 
		&lt;param-value&gt;80000&lt;/param-value&gt; 
            &lt;/init-param&gt; 
    &lt;/servlet&gt; 
		
    &lt;servlet-mapping&gt; 
        &lt;servlet-name&gt;control&lt;/servlet-name&gt; 
            &lt;url-pattern&gt;servlet/control&lt;/url-pattern&gt; 
    &lt;/servlet-mapping&gt; 

    &lt;!--=========== DbForms FileServlet =====================--&gt; 
    &lt;servlet&gt; 
        &lt;servlet-name&gt;file&lt;/servlet-name&gt; 
	&lt;servlet-class&gt;org.dbforms.util.FileServlet&lt;/servlet-class&gt; 		
        &lt;load-on-startup&gt;2&lt;/load-on-startup&gt; 
    &lt;/servlet&gt; 
		
    &lt;servlet-mapping&gt; 
	&lt;servlet-name&gt;file&lt;/servlet-name&gt; 
	&lt;url-pattern&gt;servlet/file&lt;/url-pattern&gt; 
    &lt;/servlet-mapping&gt; 
                </programlisting></example>
                <example><title id="taglibdesc">Changes in web.xml to enable DbForms(2)</title>
                <programlisting>
    &lt;!--=========== DbForms Tag Library Descriptor ==========--&gt; 
    &lt;taglib&gt; 
	&lt;taglib-uri&gt;/WEB-INF/dbforms.tld&lt;/taglib-uri&gt; 
	&lt;taglib-location&gt;/WEB-INF/dbforms.tld&lt;/taglib-location&gt; 
    &lt;/taglib&gt; 
		
    &lt;!--============= DBFORMS STYLING TEMPLATES =============--&gt; 
    &lt;context-param&gt; 
	&lt;param-name&gt;templateBase&lt;/param-name&gt; 
	&lt;param-value&gt;templates&lt;/param-value&gt; 
    &lt;/context-param&gt; 
		
    &lt;/web-app&gt; 
		</programlisting>
			</example>
			<para>
				<emphasis role="bold">Remarks</emphasis>
			</para>
			<para>The init-parameter <computeroutput>log4j.configuration</computeroutput> should point to a valid log4j-property file. If this parameter is not defined, the log4j standard configuration will be used for logging.
</para>
			<para>Now that log4j handles all console output, you would think that by setting log4jto display fatal errors only, your console would be virtually empty.  Well, no!The current version of dbForms uses the struts digester class to parse xml filesat startup.  This class sends info to System.out.  The init-parameter "digesterDebugLevel" setting can be used to specify (to the digester) the amount of detail to display.  Values can range from 0  (no debug) to 10 (Show all).
</para>
			<para>DbForms v1.1 introduced support for internationalization (i18n).  Labels, messages, etc. can be stored in 'resource bundle' files and retrieved using appropriate DbForm tags.  The (optional) init-parameter 'resourceBundle' setting is used to specify the resource bundle root name.  Refer to the section on internationalization.
</para>
			<para>Enhanced validation features results from the integration of the Commons-Validator framework into dbForms v1.1.  This framework requires the use of two distinct xml descriptor files. The (optional) init-parameters 'validator-rules' and 'validation' are used to specify these files.  Refer to the section on validation.
</para>
			<para>The init-parameter <computeroutput>maxUploadSize</computeroutput> tells DbForms how big of a file upload it should accept. If no value is set, a default value will be used. Setting any kind of upload size is important to protect the system against DoS (Denial of Service) attacks.
</para>
			<para>Tags for defining security constraints are not shown in Listing 27. Please refer to the examples and descriptions in DbForms-distribution, your Applications Servers manual and Java Servlet Specification 2.2 (especially chapters 11.5 and 13.3.2) for information about web-application security.
</para>
			<para>However, a typical security-aware web application deployment descriptor has the following elements inside its &lt;<computeroutput>web</computeroutput>-<computeroutput>app</computeroutput>&gt; element:
</para>
			<example>
				<title>Listing 28  deploying a security aware application
</title>
				<programlisting>&lt;!--==*************************************************==--&gt;&lt;!--==**======= YOUR APPLICATION's SECURITY =========**==--&gt; 
		&lt;!--==*************************************************==--&gt; 
		&lt;!--=================== roles ===========================--&gt; 
		&lt;security-role&gt; 
		&lt;description&gt;Have read only access&lt;/description&gt; 
		&lt;role-name&gt;guests&lt;/role-name&gt; 
		&lt;/security-role&gt; 
		&lt;security-role&gt; 
		&lt;description&gt;Registered users can do stuff, others not.&lt;/description&gt; 
		&lt;role-name&gt;a_users&lt;/role-name&gt; 
		&lt;/security-role&gt; 
		&lt;security-role&gt; 
		&lt;description&gt;Registered users can do less then users_a&lt;/description&gt; 
		&lt;role-name&gt;b_users&lt;/role-name&gt; 
		&lt;/security-role&gt; 
		&lt;!--=================== login config ====================--&gt; 
		&lt;login-config&gt; 
		&lt;auth-method&gt;FORM&lt;/auth-method&gt; 
		&lt;realm-name&gt;Form-Based Authentication Area&lt;/realm-name&gt; 
		&lt;form-login-config&gt; 
		&lt;form-login-page&gt;/login.jsp&lt;/form-login-page&gt; 
		&lt;form-error-page&gt;/login.jsp&lt;/form-error-page&gt; 
		&lt;/form-login-config&gt; 
		&lt;/login-config&gt; 
		&lt;!--
 
		&lt;login-config&gt; 
		&lt;auth-method&gt;BASIC&lt;/auth-method&gt; 
		&lt;realm-name&gt;Example Basic Authentication Area&lt;/realm-name&gt; 
		&lt;/login-config&gt; 
		--&gt; 
		&lt;!--=================== authentification   ==============--&gt; 
		&lt;!--
 
		we protect everything in directory <emphasis role="italic">/protected</emphasis> 
		however, be sure NOT to protect login.jsp/logout.jsp
 
		in most containers this would lead to endless recursion
 
		which end with a crash of the Java Virtual Machine
 
		("StackOverFlow")
 
		--&gt; 
		&lt;security-constraint&gt; 
		&lt;web-resource-collection&gt; 
		&lt;web-resource-name&gt;myapp&lt;/web-resource-name&gt; 
		&lt;url-pattern&gt;/protected/*&lt;/url-pattern&gt; 
		&lt;/web-resource-collection&gt; 
		&lt;auth-constraint&gt; 
		&lt;role-name&gt;a_users&lt;/role-name&gt; 
		&lt;role-name&gt;b_users&lt;/role-name&gt; 
		&lt;role-name&gt;guests&lt;/role-name&gt; 
		&lt;/auth-constraint&gt; 
		&lt;/security-constraint&gt; 
		</programlisting>
			</example>
		</sect2>
 
 <sect2>
			<title>Typical deployment structure of Web-Apps using DbForms
</title>
			<para>Finally, here a short list of files to check when deploying a web-application using DbForms:
</para>
			<example>
<title>Structure of a typical DbForm application
</title>
<programlisting>
                /yourfile1.jsp
                /yourfile2.jsp
                /yourfile1.html
                /yourfile2.html
 
                ../templates/yourTemplateA/yourTemplateA_begin.jsp
		../templates/yourTemplateA/yourTemplateA_end.jsp
		../templates/templateB/templateB_begin.jsp
		../templates/templateB/templateB_end.jsp
 
		/WEB-INF/<emphasis role="bold">web.xml</emphasis> 
		/WEB-INF/dbforms-config.xml
		/WEB-INF/dbforms.tld
 
		/WEB-INF/lib/<emphasis role="bold">dbforms.jar</emphasis> 
		/WEB-INF/lib/<emphasis role="bold">struts.jar</emphasis> 
		/WEB-INF/lib/<emphasis role="bold">cos.jar</emphasis>
                /WEB-INF/lib/<emphasis role="bold">...etc</emphasis>
		
                /WEB-INF/classes/yourservlet1.class
		/WEB-INF/classes/yourservlet2.class
                
		/WEB-INF/classes/yourinterceptorI.class
		/WEB-INF/classes/yourinterceptorII.class

		/WEB-INF/classes/...
                </programlisting>
                </example>
                <para>Info: a complete example of a deployment structure of a <emphasis role="bold">security-aware</emphasis> DbForms-Applications can be found in the example-apps included in various DbForms-distributions (version 0.7 or higher)
</para></sect2>
		 
</sect1>
</chapter>