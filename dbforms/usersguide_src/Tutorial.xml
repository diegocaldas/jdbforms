<?xml version="1.0" encoding="UTF-8"?>
 
	<chapter>
		<title>Tutorial: A sample application
</title>
		<sect1>
			<title>About the application: requirements specification
</title>
			<para>Lets imagine were supposed to write a little Customer-Care application for an agency which sells services to customers. The application is used mainly by sales people.
</para>
			<para>The users of this application should be able to perform the following tasks:
</para>
			<itemizedlist mark="opencircle">
     <listitem>    <para>add and modify services that are sold to customers
</para>          </listitem>     
                        
<listitem>
<para>add and modify customer data
</para>
</listitem>
<listitem>
<para>input customer orders
</para>
</listitem>
<listitem>
<para>register customer complaints
</para></listitem>


	<listitem>	<para>assign a 'priority level' to a customer complaint
</para></listitem>
</itemizedlist>

			
			
			
	
			<para>The application should be capable of supporting concurrent users and should be web-based. Also, lets imagine our boss wants this application done in say, two days!
</para>
			<para>No problem! As youll see, we will complete this application in less than two hours.  What to do with the rest of the time allocated to this project?  Take a mini vacation (
</para>
		</sect1>
		<sect1>
			<title>Defining the database model and the database connection
</title>
			<para>First of all, we should design the database model. (If a database model would have already existed, then we could have skipped this task and simply re-use the existing model ).  DbForms has no special requirements on the database model.
</para>
			<para>In our case were forced to do all design work from scratch. Here is a simple model which addresses the requirements defined above
</para>
			<sect2>
				<title>Conceptual design
</title>
				<para/>
				<para>
					<figure>
						<title>Figure 4 - a conceptual diagram of the database we are planning
</title>
						<graphic fileref="4" format="GIF"/>
					</figure>
				</para>
				<para>This database model will be used during the tutorial.
</para>
			</sect2>
			<sect2>
				<title>Physical table creation
</title>
				<para>Here is the SQL code for creating the database model shown in Figure 4:
</para>
				<example>
					<title/>
					<programlisting>
                CREATE TABLE service (

                id int NOT NULL PRIMARY KEY,
 
		name char (30) NULL ,
 
		description char (255) NULL
 
		)
                
 
		CREATE TABLE customer (
 
		id int NOT NULL PRIMARY KEY,
 
		firstname char (50) NULL ,
 
		lastname char (50) NULL ,
 
		address char (30) NULL ,
 
		pcode char (10) NULL ,
 
		city char (40) NULL
 
		)
 
		CREATE TABLE order (
 
		order_id int IDENTITY  NOT NULL ,
 
		customer_id int NOT NULL ,
 
		service_id int NULL ,
 
		orderdate char (20) NULL ,
 
		PRIMARY KEY ( order_id, customer_id )
 
		)
                
 
		CREATE TABLE complaint (
 
		complaint_id int IDENTITY NOT NULL ,
 
		customer_id int NOT NULL ,
 
		usermessage char (255) NULL ,
 
		incomingdate char (20) NULL ,
 
		priority int NULL ,
 
		PRIMARY KEY ( complaint_id, customer_id )
 
		)
 
		CREATE TABLE priority (
 
		id char (10) NOT NULL PRIMARY KEY,
 
		shortname char (30) NULL ,
 
		description char (100) NULL
 
		)
 
		</programlisting>
				</example>
				<para>It would be desirable to add referential integrity, (by adding foreign keys and/or triggers) but to keep things simple</para>
			</sect2>
			<sect2>
				<title>Defining a database description for DbForms
</title>
				<para>The next step is to create the XML-based description of this model, as follows.
</para>
				<example>
					<title/>
					<programlisting>
            &lt;table name="<emphasis role="bold">service</emphasis>"&gt;
                &lt;field name="id" fieldType="int" isKey="true" /&gt; 
		&lt;field name="name" fieldType="char" /&gt; 
		&lt;field name="description" fieldType="char" /&gt; 
            &lt;/table&gt;
             
            &lt;table name="<emphasis role="bold">customer</emphasis>"&gt; 
		&lt;field name="id" fieldType="int" isKey="true"/&gt; 
		&lt;field name="firstname" fieldType="char" /&gt; 
		&lt;field name="lastname" fieldType="char" /&gt; 
		&lt;field name="address" fieldType="char" /&gt; 
		&lt;field name="pcode" fieldType="char" /&gt; 
		&lt;field name="city" fieldType="char" /&gt;
            &lt;/table&gt;
             
            &lt;table name="<emphasis role="bold">orders</emphasis>"&gt; 
		&lt;field name="order_id" fieldType="int" isKey ="true" identity="true" /&gt; 
		&lt;field name="customer_id" fieldType="int" isKey ="true" /&gt; 
		&lt;field name="service_id" fieldType="char" /&gt; 
		&lt;field name="orderdate" fieldType="char" /&gt; 
            &lt;/table&gt;
                 
            &lt;table name="<emphasis role="bold">complaint</emphasis>"&gt; 
		&lt;field name="complaint_id" fieldType="int" isKey="true" identity="true" /&gt; 
		&lt;field name="customer_id" fieldType="int" isKey ="true" /&gt; 
		&lt;field name="usermessage" fieldType="char" /&gt; 
		&lt;field name="incomingdate" fieldType="char" /&gt; 
		&lt;field name="priority" fieldType="int" /&gt; 
            &lt;/table&gt;
             
            &lt;table name="<emphasis role="bold">priority</emphasis>"&gt; 
		&lt;field name="id" fieldType="int" isKey ="true" /&gt; 
		&lt;field name="shortname" fieldType ="char" /&gt; 
		&lt;field name="description" fieldType ="char" /&gt; 
            &lt;/table&gt; 
		</programlisting>
				</example>
				<para>
					<emphasis role="bold">There exists a little tool which does all the painful work of transferring a database scheme into XML. See chapter </emphasis>Error! Reference source not found.<emphasis role="bold"> and appendix III for more information.</emphasis>
				</para>
				<para>NOTE: If we would want to use advanced DbForms-features like fine-grained-security, sorting facility, etc. We would need to add additional information to the XML-description. This will be shown in the advanced tutorial mentioned earlier.
</para>
			</sect2>
		</sect1>
		<sect1>
			<title>Planning the overall structure and screen-flow of the application
</title>
			<para>To fulfill the requirements, we need to implements at least the following JSP  views:
</para>
			<table>
				<title>Table 1  core requirements for our sample application
</title>
				<tgroup cols="2">
					<tbody>
						<row>
							<entry>Services</entry>
							<entry>Manage the services &amp; products the agency offers</entry>
						</row>
						<row>
							<entry>Orders</entry>
							<entry>Manage customer orders</entry>
						</row>
						<row>
							<entry>Complaints</entry>
							<entry>Manage customer complaints</entry>
						</row>
					</tbody>
				</tgroup>
			</table>
			<para>In addition to the core requirements, well implement the following views for users convenience:
</para>
			<table>
				<title>Table 2  additional features for our sample application
</title>
				<tgroup cols="2">
					<tbody>
						<row>
							<entry>Main Menu</entry>
							<entry>The point of entry for the application that links to all other views</entry>
						</row>
						<row>
							<entry>List of customers</entry>
							<entry>This page provides a listing (overview) of all customers enables the user to select a customer and jump to the appropriate input-page</entry>
						</row>
						<row>
							<entry>All infos about customers</entry>
							<entry>This page shows all orders and all complaints for a given customer  displayed data may be edited from this page.</entry>
						</row>
						<row>
							<entry>Priorities</entry>
							<entry>Every complaint has to be assigned to a certain level of priority. This page gives the user the ability to edit the valid priority  codes that may be used at the complaints-view</entry>
						</row>
					</tbody>
				</tgroup>
			</table>
			<para>
				<figure>
					<title>Figure 5 - screen flow of our application
</title>
					<graphic fileref="5" format="GIF"/>
				</figure>
			</para>
		</sect1>
		<sect1>
			<title>Implementing the Forms
</title>
			<para>The following sections will demonstrate how to create our sample-application using some basic and some more advanced elements of DbForms.
</para>
			<para>For each JSP view we are going to discuss here, I will show the JSP source containing DbForms-elements (printed in <emphasis role="bold">bold</emphasis> style) and then show a representative screenshot of the resulting JSP page.
</para>
			<para>I highly suggest installing the dbForms example application and taking a detailed look at it  you will quickly find out how the elements behave and which pattern of combined DbForms-elements is used best for each purpose.
</para>
			<para>For more detailed information about each DbForms-Custom Tag, please refer to the <emphasis role="bold">DbForms Custom Tag Library</emphasis> chapter, which contains a complete description of all DbForms-Tags and their attributes.
</para>
			<sect2>
				<title>Main-Menu (menu.jsp)
</title>
				<para>The main menus only purpose is to link to the other pages. Of course, this could be done by simply coding html-hyperlinks, but I would like to demonstrate how to use an empty <emphasis role="bold">dbform</emphasis>  element and how to use <emphasis role="bold">gotoButton</emphasis> elements:
</para>
				<example>
					<title/>
					<programlisting>
&lt;%@ taglib uri="/WEB-INF/dbForms.tld" prefix="db" %&gt;
 &lt;html&gt;
  &lt;head&gt;
    &lt;db:base/&gt; 
  &lt;/head&gt;
     
  &lt;body&gt; 
    &lt;h1&gt;Menu&lt;/h1&gt; 
    &lt;db:dbform followUp="/menu.jsp"&gt;
 
    &lt;center&gt;
     
    &lt;p&gt;
     &lt;db:gotoButton caption="Edit services" destination="/service.jsp" 
     destTable="services"/&gt;
    &lt;/p&gt; 
    &lt;p&gt;
        &lt;db:gotoButton caption="Customer-List" destination="/customerlist.jsp" 
        destTable="customer" /&gt;
    &lt;/p&gt; 
    &lt;p&gt;
        &lt;db:gotoButton caption="Edit Orders" destination="/customer_orders.jsp" 
        destTable="customer"/&gt;
    &lt;/p&gt; 
    &lt;p&gt;
        &lt;db:gotoButton caption="Edit Complaints" destination="/customer_complaints.jsp" 
        destTable="customer"/&gt;
    &lt;/p&gt; 
    &lt;p&gt;
        &lt;db:gotoButton caption="View all customer info" destination="/customer_all.jsp" 
        destTable="customer"/&gt;
    &lt;/p&gt; 
    &lt;p&gt;
        &lt;db:gotoButton caption="Edit priority-table" destination="/priorities.jsp" 
        destTable="priorities" /&gt;
    &lt;/p&gt; 

        &lt;/center&gt;
        
    &lt;/db:dbform&gt;

  &lt;/body&gt;
 &lt;/html&gt; 
		</programlisting>
				</example>
				<para>
					<emphasis role="bold">Remarks</emphasis>
				</para>
				<para>The <emphasis role="bold">&lt;%@ taglib uri="/WEB-INF/dbForms.tld" prefix="db" %&gt; - </emphasis>element refers to the Taglib Descriptor (tld) of DbForms and defines the prefix used to identify the elements of the tag library (in our sample application we are using <emphasis role="bold">db</emphasis>, but you could use any other namespace as well)
</para>
				<para>We used the following attributes of  <emphasis role="bold">gotoButton :</emphasis>
				</para>
				<para>
					<emphasis role="bold">caption</emphasis>: the caption of the button
</para>
				<para>
					<emphasis role="bold">destination</emphasis>: the URL of the view to jump to
</para>
				<para>
					<emphasis role="bold">destTable</emphasis>: the table of the top-level form to jump to
</para>
				<para>Please note: destTable was introduced as a workaround during transition from 0.6 to 0.7. It's very likely that this (a little bit annoying) attribute will be removed again!
</para>
				<para>The <emphasis role="bold">&lt;db:base/&gt;</emphasis>- tag should be included in every JSP-view containing DbForms-elements. It ensures that images, Cascade Style-Sheets and relative links to other pages are found.
</para>
				<para>
					<computeroutput/>
				</para>
				<para>
					<figure>
						<title>Figure 6 - main menu (menu.jsp)
</title>
						<graphic fileref="6" format="GIF"/>
					</figure>
				</para>
			</sect2>
			<sect2>
				<title>Services (service.jsp)
</title>
				<para/>
				<para>This page enables the user(s) to administer the services the agency sells to its customers. The user should get a list of all the existing services along with text fields and buttons to update and delete rows. Finally an empty input mask for inserting new services is also presented.
 </para>
				<example>
					<title/>
					<programlisting>
        &lt;%@ taglib uri="/WEB-INF/dbForms.tld" prefix="db" %&gt;
            &lt;html&gt;
             
		&lt;head&gt; 
                    &lt;db:base/&gt; 
		&lt;/head&gt;
                 
		&lt;body&gt;
                 
                    &lt;db:errors/&gt;
                                         
                    &lt;db:dbform tableName="service" maxRows="*" followUp="/service.jsp"&gt; 
                        &lt;db:header&gt; 
                        &lt;db:gotoButton caption="Menu" destination="/menu.jsp" /&gt; 
                        
                        &lt;h1&gt;Services we provide&lt;/h1&gt; 
                        
                        &lt;center&gt;
                            &lt;h3&gt;Our existing services&lt;/h3&gt;
                        &lt;/center&gt;
                         
                        &lt;table border="5" width="60%" align="CENTER"&gt; 
                            &lt;tr&gt; 
                                &lt;th&gt;ID&lt;/th&gt; 
                                &lt;th&gt;Name&lt;/th&gt; 
                                &lt;th&gt;Description&lt;/th&gt; 
                                &lt;th&gt;Actions&lt;/th&gt; 
                            &lt;/tr&gt;
                             
                        &lt;/db:header&gt;
                         
                        &lt;db:body&gt;
                 
                            &lt;tr&gt; 
                                &lt;td&gt;
                                    &lt;db:textField fieldName="id" size="5"/&gt;
                                &lt;/td&gt; 
                                &lt;td&gt;
                                    &lt;db:textField fieldName="name" size="20" 
                                    maxlength="30"/&gt;
                                &lt;/td&gt; 
                                &lt;td&gt;
                                    &lt;db:textField fieldName="description" size="24" 
                                    maxlength="255"/&gt;
                                &lt;/td&gt; 
                                &lt;td&gt;
                                    &lt;db:updateButton caption="Update"/&gt;
                                    &lt;db:deleteButton caption="Delete"/&gt;
                                &lt;/td&gt; 
                            &lt;/tr&gt;
                 
                        &lt;/db:body&gt;
                 
                        &lt;db:footer&gt;
                 
                        &lt;/table&gt;
                         
                        &lt;center&gt;&lt;h3&gt;Enter new service:&lt;/h3&gt;&lt;/center&gt;
                     
                        &lt;table align="center" border="3"&gt;     
                            &lt;tr&gt; 
                                &lt;td&gt;Id&lt;/td&gt; 
                                &lt;td&gt;&lt;db:textField size="5" fieldName="id"/&gt;&lt;/td&gt; 
                            &lt;/tr&gt; 
                            &lt;tr&gt; 
                                &lt;td&gt;Name&lt;/td&gt; 
                                &lt;td&gt;&lt;db:textField size="20" maxlength="30" fieldName="name"/&gt;&lt;/td&gt; 
                            &lt;/tr&gt; 
                            &lt;tr&gt; 
                                &lt;td&gt;Description&lt;/td&gt; 
                                &lt;td&gt;
                                    &lt;db:textArea rows="4" cols="20" wrap="virtual"
                                    fieldName="description"/&gt;
                                &lt;/td&gt; 
                            &lt;tr&gt; 
                        &lt;/table&gt;&lt;br&gt;
                        
                            &lt;center&gt;&lt;db:insertButton caption="Insert new service!"/&gt;&lt;/center&gt; 
                        &lt;/db:footer&gt; 
                    &lt;/db:dbform&gt; 
                &lt;/body&gt; 
            &lt;/html&gt; 
		</programlisting>
                
                
				</example>
				<para>
					<emphasis role="bold">Remarks</emphasis>
				</para>
				<para>We have set <emphasis role="bold">maxRows</emphasis> to <emphasis role="bold">*</emphasis> which is equivalent to 'get all rows'. If the data requested contains a great number of rows, we might consider setting <emphasis role="bold">maxRows</emphasis> to 10, 20 or another limited number.  In this situation, we would instantiate navigation  buttons for scrolling between the pages. We will use that pattern later on.
</para>
				<para>The <emphasis role="bold">&lt;errors/&gt;</emphasis> tag shows a list of errors, if any occurred (i.e. duplicate key error, etc.)
</para>
				<para>The <emphasis role="bold">&lt;db:updateButton&gt;</emphasis>and<emphasis role="bold">&lt;db:deleteButton&gt;</emphasis> - tags are placed in the body and are therefore rendered for each row.
</para>
				<para/>
				<para>
					<figure>
						<title>Figure 7 - managing services (service.jsp)
</title>
						<graphic fileref="7" format="GIF"/>
					</figure>
				</para>
				<para>
					<emphasis role="bold">Priorities (priorities.jsp)</emphasis>
				</para>
				<para/>
				<para>This page enables the user to manage a list of priorities we will use this data later in the <computeroutput>complaints</computeroutput> page where we will prompt the user to select the appropriate priority for a user's complaint. This setting could be used to help prioritize a to-do list or something similar  (however, that functionality is not included in the sample application)
</para>
								 
				<example>
					<title/>
					<programlisting>
            &lt;html&gt;
                &lt;head&gt; 
                    &lt;db:base/&gt; 
		&lt;/head&gt; 
		
                &lt;body&gt; 
                    &lt;db:errors/&gt; 
                    &lt;db:dbform tableName="priority" maxRows="*" 
                    followUp="/priorities.jsp" autoUpdate="true"&gt; 
                        &lt;db:header&gt;
                         
                            &lt;db:gotoButton caption="Menu" destination="/menu.jsp" /&gt; 
                            &lt;h1&gt;Priority Definitions&lt;/h1&gt; 
                            &lt;center&gt;&lt;h3&gt;Existing Priority Definitions:&lt;/h3&gt;&lt;/center&gt; 
                                &lt;table border="5" width="60%" align="CENTER"&gt; 
                                    &lt;tr&gt; 
                                        &lt;th&gt;Id&lt;/th&gt; 
                                        &lt;th&gt;Short Name&lt;/th&gt; 
                                        &lt;th&gt;Description&lt;/th&gt; 
                                        &lt;th&gt;Actions&lt;/th&gt; 
                                    &lt;/tr&gt; 
                        &lt;/db:header&gt;
                         
                        &lt;db:body&gt; 
                                    &lt;tr&gt; 
                                        &lt;td&gt;&lt;db:label fieldName="id"/&gt;&lt;/td&gt; 
                                        &lt;td&gt;&lt;db:textField fieldName="shortname"/&gt;&lt;/td&gt; 
                                        &lt;td&gt;
                                            &lt;db:textField fieldName="description"/&gt;
                                        &lt;/td&gt; 
                                        &lt;td&gt; 
                                             &lt;db:updateButton caption="update"/&gt; 
                                             &lt;db:deleteButton caption="delete"/&gt; 
                                        &lt;/td&gt; 
                                    &lt;/tr&gt; 
                        &lt;/db:body&gt;
                         
                        &lt;db:footer&gt; 
                                &lt;/table&gt; 
                                &lt;center&gt;&lt;h3&gt;Enter new Priority Definitions:&lt;/h3&gt;&lt;/center&gt; 
                                &lt;table border="3" align="center"&gt; 
                                    &lt;tr&gt; 
                                        &lt;td&gt;Id&lt;/td&gt; 
                                        &lt;td&gt;&lt;db:textField size="3" fieldName="id"/&gt;&lt;/td&gt; 
                                    &lt;/tr&gt; 
                                    &lt;tr&gt; 
                                        &lt;td&gt;Short-Name&lt;/td&gt; 
                                        &lt;td&gt;&lt;db:textField fieldName="shortname"/&gt;&lt;/td&gt; 
                                    &lt;/tr&gt; 
                                    &lt;tr&gt; 
                                        &lt;td&gt;Description&lt;/td&gt; 
                                        &lt;td&gt;
                                            &lt;db:textArea rows="3" cols="20" fieldName="description"/&gt;
                                        &lt;/td&gt; 
                                    &lt;tr&gt; 
                                &lt;/table&gt; 
                                &lt;br&gt;
                                 
                                &lt;center&gt;
                                    &lt;db:insertButton caption="Insert new Priority Definition"/&gt;
                                &lt;/center&gt; 
                        &lt;/db:footer&gt; 
                    &lt;/db:dbform&gt; 
		&lt;/body&gt; 
            &lt;/html&gt; 
		</programlisting>
				</example>
				<para>
					<computeroutput/>
				</para>
				<para>
					<figure>
						<title>Figure 8 - defining and editing priority levels
</title>
						<graphic fileref="8" format="GIF"/>
					</figure>
				</para>
				<para>
					<emphasis role="bold">Remarks</emphasis>
				</para>
				<para>As you may have noticed, we have used the same pattern for this page as we have used for services.jsp</para>
				<para>The only real difference can be found in the <emphasis role="bold">autoUpdate</emphasis> attribute, which is set to <emphasis role="bold">true</emphasis> in priorities.jsp. This means, that all rows will be updated if their text-fields (and other data-sensitive elements) have been edited by the user.Example:
</para>
				<para>If the user edits data in priorities number 1, 2 and 3 and then clicks update, (or any other action button) <emphasis role="bold">all</emphasis> changes will be stored <emphasis role="bold">automatically</emphasis> in the database! (These automatically triggered events are called <emphasis role="italic">implicit</emphasis>, or <emphasis role="italic">secondary</emphasis> events)
</para>
			</sect2>
			<sect2>
				<title>Customer list (customerlist.jsp)
</title>
				<para/>
				<para>This convenience page provides the user with a listing of all agency customers. The user is able to select a customer from the list and perform a given operation (edit orders,  view complaints submitted by the customer)
The user should be able to delete existing customers, as well.
				</para>
				 
				<example>
					<title/>
					<programlisting>
            &lt;html&gt;
                &lt;head&gt; 
                    &lt;db:base/&gt; 
		&lt;/head&gt;
                 
		&lt;body&gt; 
                    &lt;db:errors/&gt;
                     
                    &lt;db:dbform tableName="customer" maxRows="*" followUp="/customerlist.jsp"
                    autoUpdate="false" allowNew=false&gt; 
                        
                        &lt;db:header&gt; 
                            &lt;db:gotoButton caption="Menu" destination="/menu.jsp" /&gt; 
                            &lt;h1&gt;Customer-list&lt;/h1&gt; 
                                &lt;table align="center"&gt; 
                                    &lt;tr&gt; 
                                        &lt;td&gt;&lt;/td&gt; 
                                        &lt;td&gt;First Name&lt;/td&gt; 
                                        &lt;td&gt;Last Name&lt;/td&gt; 
                                        &lt;td&gt;Address&lt;/td&gt; 
                                        &lt;td&gt;P-Code&lt;/td&gt; 
                                        &lt;td&gt;City&lt;/td&gt; 
                                        &lt;td&gt;Action&lt;/td&gt; 
                                    &lt;/tr&gt; 
                        &lt;/db:header&gt;
                         
                        &lt;db:body&gt; 
                                    &lt;tr&gt; 
                                        &lt;td&gt;&lt;db:associatedRadio name="r_customerkey" /&gt;&lt;/td&gt; 
                                        &lt;td&gt;&lt;db:label fieldName="firstname"/&gt;&lt;/td&gt; 
                                        &lt;td&gt;&lt;db:label fieldName="lastname"/&gt;&lt;/td&gt; 
                                        &lt;td&gt;&lt;db:label fieldName="address"/&gt;&lt;/td&gt; 
                                        &lt;td&gt;&lt;db:label fieldName="pcode"/&gt;&lt;/td&gt; 
                                        &lt;td&gt;&lt;db:label fieldName="city"/&gt;&lt;/td&gt; 
                                        &lt;td&gt;&lt;db:deleteButton caption="delete"/&gt;&lt;/td&gt; 
                                    &lt;/tr&gt; 
                        &lt;/db:body&gt;
                         
                        &lt;db:footer&gt; 
                                &lt;/table&gt; 
                            &lt;p&gt;
                            &lt;center&gt;
                                
                                Show
                            
                                &lt;db:gotoButton caption="orders" 
                                destination="/customer_orders.jsp" destTable = "customer" 
                                keyToKeyToDestPos="r_customerkey"
                                /&gt;
                             
                                &lt;db:gotoButton caption=" complaints " 
                                destination="/customer_complaints.jsp"
                                destTable = "customer" 
                                keyToKeyToDestPos="r_customerkey"
                                /&gt; 
		 
                                &lt;db:gotoButton caption=" all information "
                                destination="/customer_all.jsp" destTable = "customer"
                                keyToKeyToDestPos="r_customerkey"/&gt;
                                 
                                of the selected customer!
 
                            &lt;/center&gt;
                            &lt;/p&gt;
                        &lt;/db:footer&gt; 
                    &lt;/db:dbform&gt; 
                &lt;/body&gt;
            &lt;/html&gt; 
		</programlisting>
				</example>
				<para/>
				<para>
					<figure>
						<title>Figure 9 - list of existing customers
</title>
						<graphic fileref="9" format="GIF"/>
					</figure>
				</para>
				<para>
					<emphasis role="bold">Remarks</emphasis>
				</para>
				<para>In this page, we introduce a new pattern: <emphasis role="bold">associatedRadio</emphasis> elements!To demonstrate the difference between this new pattern and the old pattern, we have used <emphasis role="italic">both</emphasis> patterns in the customerlist-page:- the delete-buttons follow the old pattern- the orders, complaints and all information buttons implement the new pattern
</para>
				<para>Using associatedRadio-Elements to mark a row for certain actions (in our case navigating to orders, complaints and all information) saves a lot of space and makes for a cleaner interface. If we had to draw a button for all possible actions, the page would not look very user-friendly.
</para>
				<para>You may have noticed, that the <emphasis role="bold">gotoButton</emphasis> - tag has a strange-sounding attribute: 
</para>
				<para>
					<emphasis role="bold">keyToKeyToDestPos</emphasis> This attribute refers to the associatedRadio button. And, in fact, nomen est omen, it refers to a field  (<emphasis role="bold">customerkey</emphasis>), which has a key as its value. (i.e. <emphasis role="bold">k_2</emphasis>, if the user selected the third row) This key is used to identify the row the system will jump to (<emphasis role="bold">Dest</emphasis>ination-<emphasis role="bold">Pos</emphasis>ition), if the user clicks an action-button.
</para>
				<para>Another interesting item worth mentioning, is that the attribute <emphasis role="bold">allowNew</emphasis> is set to a value of <emphasis role="bold">false</emphasis> this has the effect, in the case of an empty result Set (no customers), of bypassing the body-tag altogether.
</para>
			</sect2>
			<sect2>
				<title>Orders (customer_orders.jsp)
</title>
				<para>This page provides the user with the ability to manage incoming orders for a given customer. The user is able to edit customer orders, as well as customer-data. The user should not be required to 'struggle' with item-numbers, but instead, should be able to simply select (from a drop down select box) the services the customer has indicated he/she is willing to purchase.
</para>
				<para/>
				<para>
					<figure>
						<title>Figure 10 - underlying data for customer_order.jsp
</title>
						<graphic fileref="10" format="GIF"/>
					</figure>
				</para>
				<para>
					<emphasis role="bold">&lt;%@ taglib uri="/WEB-INF/dbForms.tld" prefix="db" %&gt;</emphasis>
				</para>
				<example>
					<title/>
					<programlisting>
&lt;html&gt;
 &lt;head&gt; 
    <emphasis role="bold">&lt;db:base/&gt;</emphasis> 
 &lt;/head&gt;
 
 &lt;body&gt; 
    &lt;!-- show eventually occurred errors --&gt; 
    <emphasis role="bold">&lt;db:errors/&gt;</emphasis>
    <emphasis role="bold">&lt;db:dbform tableName="customer" maxRows="1" followUp="/customer_orders.jsp" autoUpdate="false"&gt;</emphasis> 

        <emphasis role="bold">&lt;db:header&gt;</emphasis> 
            <emphasis role="bold">&lt;db:gotoButton caption="Menu" destination="/menu.jsp" /&gt;</emphasis> 
            &lt;h1&gt;Customer&lt;/h1&gt; 
        <emphasis role="bold">&lt;/db:header&gt;</emphasis>
 
        <emphasis role="bold">&lt;db:body&gt;</emphasis>
         
            &lt;table align="center"&gt; 
                &lt;tr&gt; 
                    &lt;td&gt;Id &lt;/td&gt; 
                        &lt;td&gt;
                            <emphasis role="bold">&lt;db:textField fieldName="id" size="4"/&gt;
                        </emphasis>&lt;/td&gt; 
                &lt;/tr&gt; 
                &lt;tr&gt; 
                    &lt;td&gt;First Name&lt;/td&gt; 
                    &lt;td&gt;
                        <emphasis role="bold">&lt;db:textField fieldName="firstname" size="18"/&gt;
                    </emphasis>&lt;/td&gt; 
                &lt;/tr&gt; 
                &lt;tr&gt; 
                    &lt;td&gt;Last Name&lt;/td&gt; 
                    &lt;td&gt;
                        <emphasis role="bold">&lt;db:textField fieldName="lastname" size="18"/&gt;
                    </emphasis>&lt;/td&gt; 
                &lt;/tr&gt; 
                &lt;tr&gt; 
                    &lt;td&gt;Address:&lt;/td&gt; 
                    &lt;td&gt;
                        <emphasis role="bold">&lt;db:textField fieldName="address" size="25" /&gt;
                    </emphasis>&lt;/td&gt; 
                &lt;/tr&gt; 
                &lt;tr&gt; 
                    &lt;td&gt;Postal code/City&lt;/td&gt; 
                    &lt;td&gt;
                        <emphasis role="bold">&lt;db:textField fieldName="pcode" size="6"/&gt;</emphasis> -
                        <emphasis role="bold">&lt;db:textField fieldName="city" size="16"/&gt;</emphasis>
                    &lt;/td&gt; 
                &lt;/tr&gt; 
            &lt;/table&gt; 
            &lt;br&gt;
             
            &lt;!-- table embedding the sub form --&gt; 
            &lt;table align="center" border="1"&gt; 
                &lt;tr&gt; 
                    &lt;td&gt; 
                        &lt;center&gt;&lt;p&gt;&lt;b&gt;Orders&lt;/b&gt;&lt;/p&gt;&lt;/center&gt; 
                        
                        &lt;!-------- sub form begin -------&gt; 
                        <emphasis role="bold">&lt;db:dbform tableName="orders" maxRows="3" parentField="id" </emphasis> 
                        <emphasis role="bold">childField="customer_id" followUp="/customer_orders.jsp" autoUpdate="false"&gt;</emphasis> 

                            <emphasis role="bold">&lt;db:header&gt;</emphasis> 
                            &lt;!-- code for showing existing orders of services for that customer --&gt; 
                                &lt;table&gt; 
                                    &lt;tr&gt; 
                                        &lt;td width="40"&gt;&lt;/td&gt; 
                                        &lt;td&gt;service&lt;/td&gt; 
                                        &lt;td&gt;orderdate&lt;/td&gt; 
                                    &lt;/tr&gt; 
                            <emphasis role="bold">&lt;/db:header&gt;</emphasis>
 
                            <emphasis role="bold">&lt;db:body allowNew="false"&gt;</emphasis> 
                                    &lt;tr&gt; 
                                        &lt;td width="40<emphasis role="bold">"&gt;
                                            &lt;db:associatedRadio name="radio_order"/&gt;</emphasis>
                                        &lt;/td&gt; 
                                        &lt;td&gt; 
                                            <emphasis role="bold">&lt;db:select fieldName="service_id"&gt;</emphasis> 
                                                <emphasis role="bold">&lt;db:tableData</emphasis> 
                                                    <emphasis role="bold">name = "our_services"</emphasis> 
                                                    <emphasis role="bold">foreignTable = "service"</emphasis> 
                                                    <emphasis role="bold">visibleFields = "name"</emphasis> 
                                                    <emphasis role="bold">storeField = "id"</emphasis> 
                                                <emphasis role="bold">/&gt;</emphasis> 
                                            <emphasis role="bold">&lt;/db:select&gt;</emphasis> 
                                        &lt;/td&gt; 
                                        &lt;td<emphasis role="bold">&gt;
                                            &lt;db:textField fieldName="orderdate" size="14"/&gt;</emphasis>
                                        &lt;/td&gt; 
                                    &lt;/tr&gt; 
                            <emphasis role="bold">&lt;/db:body&gt;</emphasis>
 
                            <emphasis role="bold">&lt;db:footer&gt;</emphasis> 
                                    &lt;tr&gt; 
                                        &lt;td width="40"&gt;&lt;/td&gt; 
                                        &lt;td<emphasis role="bold">&gt;
                                            &lt;db:updateButton caption="Update Order"
                                            associatedRadio="radio_order"/&gt;</emphasis>
                                        &lt;/td&gt; 
                                        &lt;td<emphasis role="bold">&gt;
                                            &lt;db:deleteButton caption="Delete Order"
                                            associatedRadio="radio_order"/&gt;</emphasis>
                                        &lt;/td&gt; 
                                    &lt;/tr&gt; 
                                &lt;/table&gt;
                                 
                                &lt;!-- code for entering new orders and services --&gt; 
                                
                                &lt;br&gt;&lt;hr&gt; 
                                &lt;table&gt; 
                                    &lt;tr&gt; 
                                        &lt;td&gt;service&lt;/td&gt; 
                                        &lt;td&gt;date&lt;/td&gt; 
                                        &lt;td&gt;&lt;/td&gt; 
                                    &lt;/tr&gt; 
                                    &lt;tr&gt; 
                                        &lt;td&gt; 
                                        <emphasis role="bold">&lt;db:select fieldName="service_id"&gt;</emphasis> 
                                            <emphasis role="bold">&lt;db:tableData</emphasis> 
                                            <emphasis role="bold">name = "our_services"</emphasis> 
                                            <emphasis role="bold">foreignTable = "service"</emphasis> 
                                            <emphasis role="bold">visibleFields = "name"</emphasis> 
                                            <emphasis role="bold">storeField = "id"</emphasis>
                                            <emphasis role="bold">/&gt;</emphasis> 
                                        <emphasis role="bold">&lt;/db:select&gt;</emphasis> 
                                        &lt;/td&gt; 
                                        &lt;td<emphasis role="bold">&gt;
                                            &lt;db:textField fieldName="orderdate" size="10" /&gt;</emphasis>
                                        &lt;/td&gt; 
                                        &lt;td<emphasis role="bold">&gt;
                                            &lt;db:insertButton caption="insert order" /&gt;</emphasis>
                                        &lt;/td&gt; 
                                    &lt;/tr&gt; 
                                &lt;/table&gt;
                                 
                                &lt;center&gt; 
                                <emphasis role="bold">&lt;db:navFirstButton caption="lt;lt; First" /&gt;</emphasis> 
                                <emphasis role="bold">&lt;db:navPrevButton caption="lt; Previous" /&gt;</emphasis> 
                                <emphasis role="bold">&lt;db:navNextButton caption="Next gt;" /&gt;</emphasis> 
                                <emphasis role="bold">&lt;db:navLastButton caption="Last gt;gt;" /&gt;</emphasis> 
                                &lt;/center&gt; 
                            <emphasis role="bold">&lt;/db:footer&gt;</emphasis> 
                        <emphasis role="bold">&lt;/db:dbform&gt;</emphasis> 
                        &lt;!-------- sub form end --------&gt; 
                    &lt;/td&gt; 
                &lt;/tr&gt; 
            &lt;/table&gt; 
            &lt;!-- end of table embedding the sub form --&gt; 
            
            &lt;br&gt;
            &lt;center&gt; 
             <emphasis role="bold">&lt;db:insertButton caption="Store this new Customer!"  /&gt;</emphasis> 
             <emphasis role="bold">&lt;db:updateButton caption="Update Customer"  /&gt;</emphasis> 
             <emphasis role="bold">&lt;db:deleteButton caption="Delete Customer"  /&gt;</emphasis> 
            &lt;/center&gt; 
        &lt;/db:body&gt;
         
        <emphasis role="bold">&lt;db:footer&gt;</emphasis> 
            &lt;br&gt;
            &lt;center&gt; 
            <emphasis role="bold">&lt;db:navFirstButton caption="lt;lt; First" /&gt;</emphasis> 
            <emphasis role="bold">&lt;db:navPrevButton caption="lt; Previous" /&gt;</emphasis> 
            <emphasis role="bold">&lt;db:navNextButton caption="Next gt;"  /&gt;</emphasis> 
            <emphasis role="bold">&lt;db:navLastButton caption="Last gt;gt;" /&gt;</emphasis> 
            <emphasis role="bold">&lt;db:navNewButton caption="nbsp;nbsp;*nbsp;nbsp;"/&gt;</emphasis> 
            &lt;/center&gt; 
        <emphasis role="bold">&lt;/db:footer&gt;</emphasis> 
    <emphasis role="bold">&lt;/db:dbform&gt;</emphasis>
  &lt;/body&gt; 
 &lt;/html&gt;
		</programlisting>
				</example>
				<para>
					<emphasis role="bold">Remarks</emphasis>
				</para>
				<para>Within this page, we have introduced several new DbForm features:
</para>
				<para>Nested Forms: The structure of this page is similar to the structure shown in Figure 3  a main form has a sub-form in its body. The sub-form is linked to its parent by the equality of data-fields [if there is more than one field to define for correct mapping, a <emphasis role="bold">field-list</emphasis> may be provided, with each field separated from the other by commas or semicolons (<emphasis role="bold">,</emphasis> or <emphasis role="bold">;</emphasis>)] defined in the child - forms <emphasis role="bold">parentField</emphasis> and <emphasis role="bold">childField</emphasis> attributes.
</para>
				<para>Navigation-Buttons: Because only <emphasis role="italic">one</emphasis> customer is visible at once, the user needs a means of navigating between records. This functionality is provided by <emphasis role="bold">navFirst</emphasis><emphasis role="bold">Button, navLastButton, navPrevButton, navNextButton</emphasis> tags.
</para>
				<para>Insert-Button: the <emphasis role="bold">navNewButton</emphasis> tag navigates the user to an empty form.
</para>
				<para>Select-Tag: In addition to textField and textArea  tags, more complex elements like <emphasis role="bold">select</emphasis>, <emphasis role="bold">radio</emphasis> and <emphasis role="bold">checkbox</emphasis> can be used for data-visualization and manipulation. I have chosen a <emphasis role="bold">select</emphasis> - tag to display the type of services available.
</para>
				<para>External data is fetched by a <emphasis role="bold">tableData</emphasis>-tag: This tag provides external data to <emphasis role="bold">radio</emphasis>, <emphasis role="bold">checkbox</emphasis> or <emphasis role="bold">select</emphasis> - tags. It may be used for cross references to other tables. In our case, we initialized the select-box with external data from the service table.Be aware that you have to distinguish between the field(s) to be <emphasis role="italic">shown</emphasis> to the user and the field to be <emphasis role="italic">stored</emphasis> in the associated field in the table. In our case we <emphasis role="italic">showed</emphasis> the field service.name and <emphasis role="italic">stored</emphasis> the value service.id in the associated field orders.service_id! The name <emphasis role="bold">our_services</emphasis> was defined to enable internal caching of the data, which increases performance.
</para>
				<para>
					<computeroutput/>
				</para>
				<para>
					<figure>
						<title>Figure 11 - managing orders and customers with one single page
</title>
						<graphic fileref="11" format="GIF"/>
					</figure>
				</para>
			</sect2>
			<sect2>
				<title>Complaints (customer_complaints.jsp)
</title>
				<para>This page is conceptually similar to the previous file (customer_orders.jsp) It provides the user with the ability to manage customer complaints. The user is, once again, able to edit  customer complaints as well as customer-data, all from the same page.
</para>
				<para>To establish an order of importance, every reported complaint must be associated with a certain level of priority. To make life easier for our users, he/she should be able to simply pick a priority level from a maintainable list of predefined priority levels.
</para>
				<para/>
				<para>
					<figure>
						<title>Figure 12 - underlying data for customer_order.jsp
</title>
						<graphic fileref="12" format="GIF"/>
					</figure>
				</para>
				<example>
    					<title/><programlisting>
&lt;%@ taglib uri="/WEB-INF/dbForms.tld" prefix="db" %&gt;
 &lt;html&gt; 
  &lt;head&gt; 
    &lt;db:base/&gt; 
  &lt;/head&gt;
   
  &lt;body&gt; 
    &lt;!-- show eventually occurred errors --&gt; 
    &lt;db:errors/&gt; 
    
    &lt;db:dbform tableName="customer" maxRows="1" 
    followUp="/customer_complaints.jsp" autoUpdate="false"&gt; 

    &lt;db:header&gt; 
        &lt;db:gotoButton caption="Menu" destination="/menu.jsp" /&gt; 
        &lt;h1&gt;Customer&lt;/h1&gt; 
    &lt;/db:header&gt;
	     
    &lt;db:body&gt; 
        &lt;table align="center"&gt; 
            &lt;tr&gt; 
                &lt;td&gt;Id &lt;/td&gt; 
                &lt;td&gt;&lt;db:textField fieldName="id" size="4"/&gt;&lt;/td&gt; 
            &lt;/tr&gt; 
            &lt;tr&gt; 
                &lt;td&gt;First Name&lt;/td&gt; 
                &lt;td&gt;&lt;db:textField fieldName="firstname" size="18"/&gt;&lt;/td&gt; 
            &lt;/tr&gt; 
            &lt;tr&gt; 
                &lt;td&gt;Last Name&lt;/td&gt; 
                &lt;td&gt;&lt;db:textField fieldName="lastname" size="18"/&gt;&lt;/td&gt; 
            &lt;/tr&gt; 
            &lt;tr&gt; 
                &lt;td&gt;Address:&lt;/td&gt; 
                &lt;td&gt;&lt;db:textField fieldName="address" size="25" /&gt;&lt;/td&gt; 
            &lt;/tr&gt; 
            &lt;tr&gt; 
                &lt;td&gt;Postal code/City&lt;/td&gt; 
                &lt;td&gt; 
                    &lt;db:textField fieldName="pcode" size="6"/&gt; -
                    &lt;db:textField fieldName="city" size="16"/&gt; 
                &lt;/td&gt; 
            &lt;/tr&gt; 
        &lt;/table&gt; 
        &lt;br&gt;
         
        &lt;!-- table embedding the sub form --&gt;
         
        &lt;table align="center" border="1"&gt; 
            &lt;tr&gt; 
                &lt;td&gt; 
                    &lt;center&gt;&lt;p&gt;&lt;b&gt;Complaints&lt;/b&gt;&lt;/p&gt;&lt;/center&gt; 
                    
                    &lt;!-------- sub form begin -------&gt; 
                    &lt;db:dbform tableName="complaint" maxRows="3" parentField="id" 
                    childField="customer_id" followUp="/customer_complaints.jsp" 
                    autoUpdate="false"&gt;
                     
                    &lt;db:header&gt; 
                    
                    &lt;!-- code for showing existing complaints of the customer --&gt; 
                        &lt;table&gt; 
                            &lt;tr&gt; 
                                &lt;td width="40"&gt;&lt;/td&gt; 
                                &lt;td&gt;users' message&lt;/td&gt; 
                                &lt;td&gt;priority&lt;/td&gt; 
                                &lt;td&gt;incoming date&lt;/td&gt; 
                            &lt;/tr&gt; 
                    &lt;/db:header&gt;
    
                    &lt;db:body allowNew="false"&gt; 
                            &lt;tr&gt; 
                                &lt;td width="40"&gt;
                                    &lt;db:associatedRadio name="radio_complaint" /&gt;
                                &lt;/td&gt; 
                                &lt;td&gt;
                                    &lt;db:textField fieldName="usermessage" size="14"/&gt;
                                &lt;/td&gt; 
                                &lt;td&gt; 
                                    &lt;db:select fieldName="priority"&gt; 
                                        &lt;db:tableData
                                            name = "some_priorities"
                                            foreignTable = "priority"
                                            visibleFields = "shortname"
                                            storeField = "id"
                                        /&gt; 
                                    &lt;/db:select&gt; 
                                &lt;/td&gt; 
                                &lt;td&gt;
                                    &lt;db:textField fieldName="incomingdate" size="14"/&gt;
                                &lt;/td&gt; 
                            &lt;/tr&gt; 
                    &lt;/db:body&gt;
    
                    &lt;db:footer&gt; 
                            &lt;tr&gt; 
                                &lt;td width="40"&gt;&lt;/td&gt; 
                                &lt;td&gt; 
                                    &lt;db:updateButton caption="Update Complaint" 
                                    associatedRadio="radio_complaint"/&gt; 
                                &lt;/td&gt; 
                                &lt;td&gt; 
                                    &lt;db:deleteButton caption="Delete Complaint" 
                                    associatedRadio="radio_complaint "/&gt; 
                                &lt;/td&gt; 
                            &lt;/tr&gt; 
                        &lt;/table&gt;
                         
                        &lt;!-- code for entering new complaints --&gt; 
                        &lt;br&gt;&lt;hr&gt; 
                        &lt;table align="center"&gt; 
                            &lt;tr&gt; 
                                &lt;td&gt;user's message&lt;/td&gt; 
                                &lt;td&gt;priority&lt;/td&gt; 
                                &lt;td&gt;date&lt;/td&gt; 
                            &lt;/tr&gt; 
                            &lt;tr&gt; 
                                &lt;td&gt;
                                    &lt;db:textArea wrap="virtual" cols="20" rows="6" 
                                    fieldName="usermessage"/&gt;
                                &lt;/td&gt; 
                                &lt;td&gt; 
                                    &lt;db:radio fieldName="priority" growDirection="vertical"&gt; 
                                        &lt;db:tableData
                                            name = "some_priorities"
                                            foreignTable = "priority"
                                            visibleFields = "shortname"
                                            storeField = "id"
                                        /&gt; 
                                    &lt;/db:radio&gt; 
                                &lt;/td&gt; 
                                &lt;td valign="top"&gt;
                                    &lt;db:textField fieldName="incomingdate" size="14" /&gt;
                                &lt;/td&gt; 
                            &lt;/tr&gt; 
                        &lt;/table&gt;
   
                        &lt;p&gt;
                        &lt;center&gt;
                            &lt;db:insertButton caption="insert new complaint" /&gt;
                        &lt;/center&gt;
                        &lt;/p&gt; 
                        &lt;p&gt;
                        &lt;center&gt; 
                            &lt;db:navFirstButton caption="lt;lt; First" /&gt; 
                            &lt;db:navPrevButton caption="lt; Previous" /&gt; 
                            &lt;db:navNextButton caption="Next gt;" /&gt; 
                        &lt;db:navLastButton caption="Last gt;gt;" /&gt; 
                        &lt;/center&gt;
                        &lt;/p&gt; 
                    &lt;/db:footer&gt;
                     
                    &lt;/db:dbform&gt; 
                    &lt;!-------- sub form end --------&gt;
                     
                &lt;/td&gt; 
            &lt;/tr&gt; 
        &lt;/table&gt; 
        &lt;!-- end of table embedding the sub form --&gt;
         
        &lt;br&gt;
        &lt;center&gt; 
            &lt;db:insertButton caption="Store this new Customer!"  /&gt; 
            &lt;db:updateButton caption="Update Customer"  /&gt; 
            &lt;db:deleteButton caption="Delete Customer"  /&gt; 
        &lt;/center&gt; 
    &lt;/db:body&gt;
     
    &lt;db:footer&gt; 
        &lt;br&gt;
        &lt;center&gt; 
          &lt;db:navFirstButton caption="lt;lt; First" /&gt; 
          &lt;db:navPrevButton caption="lt; Previous" /&gt; 
          &lt;db:navNextButton caption="Next gt;"  /&gt; 
          &lt;db:navLastButton caption="Last gt;gt;" /&gt; 
          &lt;db:navNewButton caption="nbsp;nbsp;*nbsp;nbsp;"/&gt; 
        &lt;/center&gt; 
    &lt;/db:footer&gt;
     
    &lt;/db:dbform&gt;
     
  &lt;/body&gt; 
 &lt;/html&gt; 					

		</programlisting>
				</example>
				<para>
					<emphasis role="bold">Remarks</emphasis>
				</para>
				<para>We have not used any new tags or patterns, however, we introduce some new variations of already known patterns:
</para><itemizedlist mark="opencircle">
<listitem>
<para>A group of radio-buttons, retrieved via the <emphasis role="bold">tableData</emphasis> tag, defined as <emphasis role="bold">some_priorities</emphasis>
				</para>
</listitem>
<listitem>
<para>
					<emphasis role="bold">associatedRadio</emphasis> buttons for selecting existing complaints.
</para>
</listitem>
<listitem>
<para>Navigation buttons for both, the main and the sub-form.
</para>
</listitem>
</itemizedlist>
				
				
				
				 
				 
				<para>
					<figure>
						<title>Figure 13 - managing customers and their complaints with one single page
</title>
						<graphic fileref="13" format="GIF"/>
					</figure>
				</para>
			</sect2>
			<sect2>
				<title>Customers information (customer_all.jsp)
</title>
				<para>This page is the result of merging customer_orders.jsp and customer_complaints.jsp into one big file. Given that this page does not introduce any new patterns or tags,  its code has not been included in this document.  Please refer to the example application for a complete listing .
</para>
			</sect2>
		</sect1>
	</chapter>
 
